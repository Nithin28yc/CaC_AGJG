def label = "mypod-${UUID.randomUUID().toString()}"
podTemplate(label: label, containers: [
containerTemplate(name: 'maven', image: 'maven:3.3.9-jdk-8-alpine', ttyEnabled: true, command: 'cat'),
]) {
currentBuild.description = "CDP,GDPR,HIPPA,PCI,SOX -${Project_Name}- $Workpod"
 node(label) {
      properties([pipelineTriggers([cron("${Schedule_Frequency}")]),
        parameters([string(name: 'Schedule_Frequency', defaultValue: "$Schedule_Frequency"),
        string(name: 'GIT_URL' , defaultValue: "$GIT_URL"),
        string(name: 'User_name', defaultValue: "platformadmin"),
        string(name: 'User_Password', defaultValue: "phG7+pOAL6xNCx3vLzGUlg=="),
        string(name: 'Workpod', defaultValue: "$Workpod"),
        string(name: 'Project_Name', defaultValue: "$Project_Name")])
        ])
 stage('repo clonning') {
		      
    git branch: "compliance", url: "http://gitlab.ethan.svc.cluster.local:8084/gitlab/root/complianceascode_master.git" ,credentialsId: "gitlab"     
    echo "${GIT_URL}"
}
stage('TLS protocol for data transmit'){
    sh 'sleep 35'
}
stage('Network layer security'){
    sh 'sleep 66'
}
try{
stage('AES-256 Encryption in transit')
{
	
	container('maven') {
	
	sh'''
    cd Compliance_Check
    pwd
    # give the platform url with username and password
    mvn test -Dusername="$User_name" -Dpassword="$User_Password" -DsuiteXmlFile=DataInTransitEncrypt.xml
	'''
	}
    catchError(buildResult: 'SUCCESS', stageResult: 'SUCCESS') {
                    sh "exit 0"
                }
}
}
catch(Exception e){
     catchError(buildResult: 'FAILURE', stageResult: 'FAILURE') {
                    sh "exit 1"
                }
}
stage('Nexus-upload'){
		 container('maven'){
		withCredentials([usernamePassword(credentialsId: 'nexus-creds', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')]) {
                  sh '''
                  cd Compliance_Check/apiData
                  ls
                  cat response.json
                  
                  curl --upload-file response.json -u $USERNAME:$PASSWORD -v http://nexus.ethan.svc.cluster.local:8083/nexus/repository/Compliance_Security/${JOB_NAME}/$BUILD_ID/
                  '''
			}	  
}
		
}
}
}